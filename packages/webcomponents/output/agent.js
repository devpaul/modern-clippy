!function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([function(t,e,n){"use strict";(function(t){const n="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==t?t:void 0;e.a=n}).call(this,n(3))},function(t,e,n){"use strict";var o=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))(function(i,r){function s(t){try{c(o.next(t))}catch(t){r(t)}}function a(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}c((o=o.apply(t,e||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0});const i=n(6),r=n(2),s=n(4).default,a=n(5);function c(t,e){if(null==t)throw new Error(e);return t}e.Agent=class extends HTMLElement{constructor(){super(),this._mute=!1;const t=this.attachShadow({mode:"open"}),e=document.createElement("template");e.innerHTML=a;const n=e.content.cloneNode(!0);this._overlays=c(n.querySelector("#overlays"),"missing overlay container"),this._speech=c(n.querySelector("#speech"),"missing speech container"),c(n.querySelector("slot"),"missing slot").addEventListener("slotchange",t=>{this._onSlotChange(t)});const o=document.createElement("style");o.textContent=s,t.appendChild(o),t.appendChild(n)}static get observedAttributes(){return["bundle","mute"]}get actions(){return Object.keys(this._config.animations)}get current(){return this._control&&this._control.action}attributeChangedCallback(t,e,n){switch(t){case"bundle":console.warn(`loading ${n} not implemented`);break;case"mute":this._mute="true"===n}}load(t){return o(this,void 0,void 0,function*(){for(this._config=t;this._overlays.firstChild;)this._overlays.removeChild(this._overlays.firstChild);for(let e=t.overlayCount;e>0;e--)this._createOverlay();this._overlays.style.height=t.frameSize.height+"px",this._overlays.style.width=t.frameSize.width+"px",this._soundBoard=yield r.default.load(t.soundPack),this.play("Show")})}play(t){const e=this._config.animations[t];if(!e)throw new Error(`Action ${t} does not exist`);this._control&&this._control.stopImmediately(),this.dispatchEvent(new CustomEvent("actionStart",{detail:{action:t}}));let n=0;return this._control=Object.assign({action:t},i.animator(e,e=>{const{images:o=[]}=e;this._setFrames(o);for(let t=o.length;t<this._config.overlayCount;t++)this._hideFrame(t);!this._mute&&e.sound&&this._soundBoard.play(String(e.sound)),this.dispatchEvent(new CustomEvent("frame",{detail:{action:t,frame:e,time:n}})),n+=e.duration})),this._control.done.finally(()=>{this.dispatchEvent(new CustomEvent("actionEnd",{detail:{action:t}})),this._control=void 0}),this._control}playIdle(){const t=this.actions.filter(t=>"Idle"===t.substr(0,4));this.play(t[Math.floor(Math.random()*t.length)])}stop(){this._control&&this._control.stop()}stopImmediately(){this._control&&this._control.stopImmediately()}_createOverlay(){const{characterMap:t,frameSize:{width:e,height:n}}=this._config,o=document.createElement("div");o.style.width=e+"px",o.style.height=n+"px",o.style.backgroundImage=`url(${t})`,o.style.display="none",this._overlays.appendChild(o)}_hideFrame(t=0){const e=this._overlays.children[t];e&&(e.style.display="none")}_onSlotChange(t){this._speech.style.visibility="visible",console.log("slot",t)}_setFrame(t,e,n=0){const{width:o,height:i}=this._config.frameSize,r=this._overlays.children[n];if(t%o==0&&e%i==0||console.warn(`frame ${t},${e} is not a multiple of frame size ${o},${i}`),!r)throw new Error(`Missing overlay ${n}`);r.style.display="block",r.style.backgroundPositionX=-t+"px",r.style.backgroundPositionY=-e+"px",r.style.position="absolute",r.style.top="0",r.style.left="0"}_setFrames(t){if(t)for(let e=0;e<t.length;e++){const[n,o]=t[e];this._setFrame(n,o,e)}}}},function(t,e,n){"use strict";n.r(e),n.d(e,"SoundBoard",function(){return l}),n.d(e,"CoreAudio",function(){return u});var o=n(0),i=function(t,e,n,o){return new(n||(n=Promise))(function(i,r){function s(t){try{c(o.next(t))}catch(t){r(t)}}function a(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}c((o=o.apply(t,e||[])).next())})},r=function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(t);i<o.length;i++)e.indexOf(o[i])<0&&(n[o[i]]=t[o[i]])}return n};const s=o.a.AudioContext||o.a.webkitAudioContext,a=new Map([["mp3","audio/mpeg"],["ogg","audio/ogg"]]),c=document.createElement("audio");class l{constructor(t,e){this.context=t,this.effects=e}play(t){const e=this.effects[t];if(e){"suspended"===this.context.state&&this.context.resume();const t=this.context.createBufferSource();t.buffer=e,t.connect(this.context.destination),t.start()}else console.warn(`Soundboard missing effect for ${t}`)}}class u{constructor(t=new s){this.context=t}get suspended(){return"suspended"===this.context.state}resume(){this.context.resume()}load(t){const{mp3:e,ogg:n}=t,o=r(t,["mp3","ogg"]);if(e&&this.canPlay("mp3"))return this.loadSoundPack(e);if(n&&this.canPlay("ogg"))return this.loadSoundPack(n);for(let t in o)if(this.canPlay(t))return this.loadSoundPack(o[t]);return Promise.reject(new Error("Cannot load audio. No valid type."))}canPlay(t){const e=a.get(t)||t;return c.canPlayType(e)}loadSoundPack(t){const e={},n=Object.keys(t).map(n=>{const o=t[n];return new Promise(t=>i(this,void 0,void 0,function*(){const i=yield fetch(o),r=yield i.arrayBuffer(),s=yield this.context.decodeAudioData(r);e[n]=s,t(s)}))});return Promise.all(n).then(()=>new l(this.context,e))}}e.default=new u},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";n.r(e),e.default=".root {\n\tposition: relative;\n}\n\n#speech {\n\tvisibility: hidden;\n\tposition: absolute;\n\tdisplay: block;\n\tbackground-color: #FFC;\n\tpadding: 8px;\n\tz-index: 1000;\n\tborder: 1px solid black;\n\tborder-radius: 5px;\n}\n\n.speech-bubble-left:after {\n\tcontent: '';\n\tposition: absolute;\n\tright: 0;\n\ttop: 50%;\n\twidth: 0;\n\theight: 0;\n\tborder: 20px solid transparent;\n\tborder-left-color: #ffffbb;\n\tborder-right: 0;\n\tborder-bottom: 0;\n\tmargin-top: -10px;\n\tmargin-right: -20px;\n}\n\n.content {\n\tmax-width: 200px;\n\tmin-width: 120px;\n\tfont-family: \"Microsoft Sans\", sans-serif;\n\tfont-size: 10pt;\n}\n\n#overlays {\n\tposition: relative;\n}\n\n#overlays > * {\n\tposition: absolute;\n\ttop: 0;\n\tleft: 0;\n}\n"},function(t,e){t.exports='<div class=root> <div id=speech class=speech-bubble-left> <slot name="" class=content> </slot> </div> <div id=overlays> </div> </div> '},function(t,e,n){"use strict";function o(t){return new Promise(e=>{setTimeout(e,t)})}n.r(e),n.d(e,"stepper",function(){return s}),n.d(e,"animator",function(){return a});var i=function(t,e,n,o){return new(n||(n=Promise))(function(i,r){function s(t){try{c(o.next(t))}catch(t){r(t)}}function a(t){try{c(o.throw(t))}catch(t){r(t)}}function c(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(s,a)}c((o=o.apply(t,e||[])).next())})};function r(t){let e=100*Math.random();for(const n of t)if((e-=n.weight)<=0)return n.frameIndex}function*s(t){let e=0,n=t.frames,o=!1;for(;e<n.length;){let t=n[e];(o=!!(yield t)||o)&&t.exitBranch?e=t.exitBranch:t.branching?e=r(t.branching.branches)||e+1:e++}}function a(t,e){const n=s(t);let r,a=!1,c=!1;const l=Promise.race([(()=>i(this,void 0,void 0,function*(){for(let{done:t,value:i}=n.next(a);!c&&!t;({done:t,value:i}=n.next(a)))e(i),yield o(i.duration)}))(),new Promise(t=>{r=t})]);return{done:l,stop:()=>(a=!1,l),stopImmediately(){c=!0,r()}}}}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4uL2NvbW1vbi9vdXRwdXQvdXRpbC9nbG9iYWwuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2FnZW50LnRzIiwid2VicGFjazovLy8uLi9jb21tb24vb3V0cHV0L2NvcmVBdWRpby5qcyIsIndlYnBhY2s6Ly8vKHdlYnBhY2spL2J1aWxkaW4vZ2xvYmFsLmpzIiwid2VicGFjazovLy8uL3NyYy9hZ2VudC5jc3MiLCJ3ZWJwYWNrOi8vLy4vc3JjL2FnZW50Lmh0bWwiLCJ3ZWJwYWNrOi8vLy4uL2NvbW1vbi9vdXRwdXQvdXRpbC9zbGVlcC5qcyIsIndlYnBhY2s6Ly8vLi4vY29tbW9uL291dHB1dC9hbmltYXRvci5qcyJdLCJuYW1lcyI6WyJpbnN0YWxsZWRNb2R1bGVzIiwiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiZXhwb3J0cyIsIm1vZHVsZSIsImkiLCJsIiwibW9kdWxlcyIsImNhbGwiLCJtIiwiYyIsImQiLCJuYW1lIiwiZ2V0dGVyIiwibyIsIk9iamVjdCIsImRlZmluZVByb3BlcnR5IiwiZW51bWVyYWJsZSIsImdldCIsInIiLCJTeW1ib2wiLCJ0b1N0cmluZ1RhZyIsInZhbHVlIiwidCIsIm1vZGUiLCJfX2VzTW9kdWxlIiwibnMiLCJjcmVhdGUiLCJrZXkiLCJiaW5kIiwibiIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsImdsb2JhbCIsImdsb2JhbE9iamVjdCIsInNlbGYiLCJ3aW5kb3ciLCJfX3dlYnBhY2tfZXhwb3J0c19fIiwiYW5pbWF0b3JfMSIsImNvcmVBdWRpb18xIiwiYWdlbnRTdHlsZSIsImRlZmF1bHQiLCJ0ZW1wbGF0ZVN0cmluZyIsInRocm93SWZOdWxsIiwibWVzc2FnZSIsIkVycm9yIiwiQWdlbnQiLCJIVE1MRWxlbWVudCIsIltvYmplY3QgT2JqZWN0XSIsInN1cGVyIiwidGhpcyIsIl9tdXRlIiwic2hhZG93IiwiYXR0YWNoU2hhZG93IiwidGVtcGxhdGUiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJpbm5lckhUTUwiLCJyb290IiwiY29udGVudCIsImNsb25lTm9kZSIsIl9vdmVybGF5cyIsInF1ZXJ5U2VsZWN0b3IiLCJfc3BlZWNoIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiX29uU2xvdENoYW5nZSIsInN0eWxlIiwidGV4dENvbnRlbnQiLCJhcHBlbmRDaGlsZCIsIm9ic2VydmVkQXR0cmlidXRlcyIsImFjdGlvbnMiLCJrZXlzIiwiX2NvbmZpZyIsImFuaW1hdGlvbnMiLCJjdXJyZW50IiwiX2NvbnRyb2wiLCJhY3Rpb24iLCJfb2xkVmFsdWUiLCJuZXdWYWx1ZSIsImNvbnNvbGUiLCJ3YXJuIiwiY29uZmlnIiwiZmlyc3RDaGlsZCIsInJlbW92ZUNoaWxkIiwib3ZlcmxheUNvdW50IiwiX2NyZWF0ZU92ZXJsYXkiLCJoZWlnaHQiLCJmcmFtZVNpemUiLCJ3aWR0aCIsIl9zb3VuZEJvYXJkIiwibG9hZCIsInNvdW5kUGFjayIsInBsYXkiLCJhbmltYXRpb24iLCJzdG9wSW1tZWRpYXRlbHkiLCJkaXNwYXRjaEV2ZW50IiwiQ3VzdG9tRXZlbnQiLCJkZXRhaWwiLCJ0aW1lIiwiYXNzaWduIiwiYW5pbWF0b3IiLCJmcmFtZSIsImltYWdlcyIsIl9zZXRGcmFtZXMiLCJsZW5ndGgiLCJfaGlkZUZyYW1lIiwic291bmQiLCJTdHJpbmciLCJkdXJhdGlvbiIsImRvbmUiLCJmaW5hbGx5IiwidW5kZWZpbmVkIiwiaWRsZUFjdGlvbnMiLCJmaWx0ZXIiLCJzdWJzdHIiLCJNYXRoIiwiZmxvb3IiLCJyYW5kb20iLCJzdG9wIiwiY2hhcmFjdGVyTWFwIiwib3ZlcmxheSIsImJhY2tncm91bmRJbWFnZSIsImRpc3BsYXkiLCJub2RlIiwiY2hpbGRyZW4iLCJ2aXNpYmlsaXR5IiwibG9nIiwieCIsInkiLCJiYWNrZ3JvdW5kUG9zaXRpb25YIiwiYmFja2dyb3VuZFBvc2l0aW9uWSIsInBvc2l0aW9uIiwidG9wIiwibGVmdCIsIl9zZXRGcmFtZSIsIlNvdW5kQm9hcmQiLCJDb3JlQXVkaW8iLCJfdXRpbF9nbG9iYWxfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfXyIsIl9fYXdhaXRlciIsInRoaXNBcmciLCJfYXJndW1lbnRzIiwiUCIsImdlbmVyYXRvciIsIlByb21pc2UiLCJyZXNvbHZlIiwicmVqZWN0IiwiZnVsZmlsbGVkIiwic3RlcCIsIm5leHQiLCJlIiwicmVqZWN0ZWQiLCJyZXN1bHQiLCJ0aGVuIiwiYXBwbHkiLCJfX3Jlc3QiLCJpbmRleE9mIiwiZ2V0T3duUHJvcGVydHlTeW1ib2xzIiwiQXVkaW9Db250ZXh0Iiwid2Via2l0QXVkaW9Db250ZXh0IiwibWltZU1hcCIsIk1hcCIsImF1ZGlvVGFnIiwiY29udGV4dCIsImVmZmVjdHMiLCJidWZmZXIiLCJzdGF0ZSIsInJlc3VtZSIsInNvdXJjZSIsImNyZWF0ZUJ1ZmZlclNvdXJjZSIsImNvbm5lY3QiLCJkZXN0aW5hdGlvbiIsInN0YXJ0Iiwic3VzcGVuZGVkIiwibXAzIiwib2dnIiwicmVzdCIsImNhblBsYXkiLCJsb2FkU291bmRQYWNrIiwiZm9ybWF0IiwibWltZXR5cGUiLCJjYW5QbGF5VHlwZSIsInBhY2siLCJwcm9taXNlcyIsIm1hcCIsImlkIiwic3JjIiwiZGF0YSIsImZldGNoIiwiYXJyYXlCdWZmZXIiLCJhdWRpbyIsImRlY29kZUF1ZGlvRGF0YSIsImFsbCIsImciLCJGdW5jdGlvbiIsInNsZWVwIiwibWlsbGlzZWNvbmRzIiwic2V0VGltZW91dCIsInN0ZXBwZXIiLCJwaWNrUmFuZG9tIiwiYnJhbmNoZXMiLCJwaWNrIiwiYnJhbmNoIiwid2VpZ2h0IiwiZnJhbWVJbmRleCIsIm9mZnNldCIsImZyYW1lcyIsImV4aXQiLCJleGl0QnJhbmNoIiwiYnJhbmNoaW5nIiwiZnJhbWVDYWxsYmFjayIsIml0ZXJhdG9yIiwiY2FsbEltbWVkaWF0ZSIsImltbWVkaWF0ZSIsInJhY2UiXSwibWFw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QTBHLFdBQ0FILEVBQUF2RyxFQUFBMEcsV0FFQTFHLEVBQUEyRyxVQUNBSixFQUFBTixFQUFBakcsRUFBQTJHLFVBQUFULFdBQUFLLEVBQUEsRUFHQUEsS0FJTyxTQUFBeEcsRUFBQVAsRUFBQW9ILEdBQ1AsTUFBQUMsRUFBQWIsRUFBQXhHLEdBQ0EsSUFFQXNILEVBRkFMLEdBQUEsRUFDQU0sR0FBQSxFQUVBLE1BQUF2RyxFQUFBa0MsUUFBQXNFLEtBQUEsQ0FDQSxLQUFBM0UsRUFBQXpGLFVBQUEscUJBQ0EsUUFBQTRELEtBQXNCQSxFQUFBNUYsTUFBQW9GLEdBQXFCNkcsRUFBQTlELEtBQUEwRCxJQUF1Qk0sSUFBQXZHLElBQXVCQSxPQUFBNUYsTUFBQW9GLEdBQXFCNkcsRUFBQTlELEtBQUEwRCxJQUM5R0csRUFBQTVHLFNBQ3NCNkYsRUFBSzdGLEVBQUFPLFlBSDNCLEdBTUEsSUFBQW1DLFFBQUFRLElBQ0E0RCxFQUFBNUQsTUFHQSxPQUNBMUMsT0FDQVMsS0FBQSxLQUNBd0YsR0FBQSxFQUNBakcsR0FFQTlELGtCQUNBcUssR0FBQSxFQUNBRCIsImZpbGUiOiJhZ2VudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAxKTtcbiIsImNvbnN0IGdsb2JhbE9iamVjdCA9IChmdW5jdGlvbiAoKSB7XHJcbiAgICAvLyB0aGUgb25seSByZWxpYWJsZSBtZWFucyB0byBnZXQgdGhlIGdsb2JhbCBvYmplY3QgaXNcclxuICAgIC8vIGBGdW5jdGlvbigncmV0dXJuIHRoaXMnKSgpYFxyXG4gICAgLy8gSG93ZXZlciwgdGhpcyBjYXVzZXMgQ1NQIHZpb2xhdGlvbnMgaW4gQ2hyb21lIGFwcHMuXHJcbiAgICBpZiAodHlwZW9mIHNlbGYgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgcmV0dXJuIHNlbGY7XHJcbiAgICB9XHJcbiAgICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICByZXR1cm4gd2luZG93O1xyXG4gICAgfVxyXG4gICAgaWYgKHR5cGVvZiBnbG9iYWwgIT09ICd1bmRlZmluZWQnKSB7XHJcbiAgICAgICAgcmV0dXJuIGdsb2JhbDtcclxuICAgIH1cclxufSkoKTtcclxuZXhwb3J0IGRlZmF1bHQgZ2xvYmFsT2JqZWN0O1xyXG4iLCJpbXBvcnQgeyBBZ2VudENvbmZpZ3VyYXRpb24sIEZyYW1lSW1hZ2VzIH0gZnJvbSAnbW9kZXJuLWNsaXBweSc7XG5pbXBvcnQgeyBhbmltYXRvciB9IGZyb20gJy4uLy4uL2NvbW1vbi9vdXRwdXQvYW5pbWF0b3InO1xuaW1wb3J0IGF1ZGlvLCB7IFNvdW5kQm9hcmQgfSBmcm9tICcuLi8uLi9jb21tb24vb3V0cHV0L2NvcmVBdWRpbyc7XG5cbmNvbnN0IGFnZW50U3R5bGU6IHN0cmluZyA9IHJlcXVpcmUoJy4vYWdlbnQuY3NzJykuZGVmYXVsdDtcbmNvbnN0IHRlbXBsYXRlU3RyaW5nOiBzdHJpbmcgPSByZXF1aXJlKCcuL2FnZW50Lmh0bWwnKTtcblxuZnVuY3Rpb24gdGhyb3dJZk51bGw8VCA9IGFueT4odmFsdWU6IFQgfCBudWxsIHwgdW5kZWZpbmVkLCBtZXNzYWdlOiBzdHJpbmcpOiBUIHtcblx0aWYgKHZhbHVlID09IG51bGwpIHtcblx0XHR0aHJvdyBuZXcgRXJyb3IobWVzc2FnZSk7XG5cdH1cblx0cmV0dXJuIHZhbHVlO1xufVxuXG5leHBvcnQgY2xhc3MgQWdlbnQgZXh0ZW5kcyBIVE1MRWxlbWVudCB7XG5cdHByaXZhdGUgX292ZXJsYXlzOiBIVE1MRWxlbWVudDtcblx0cHJpdmF0ZSBfc3BlZWNoOiBIVE1MRWxlbWVudDtcblx0cHJpdmF0ZSBfY29uZmlnITogQWdlbnRDb25maWd1cmF0aW9uO1xuXHRwcml2YXRlIF9jb250cm9sPzogUmV0dXJuVHlwZTx0eXBlb2YgYW5pbWF0b3I+ICYgeyBhY3Rpb246IHN0cmluZyB9O1xuXHRwcml2YXRlIF9tdXRlID0gZmFsc2U7XG5cdHByaXZhdGUgX3NvdW5kQm9hcmQhOiBTb3VuZEJvYXJkO1xuXG5cdHN0YXRpYyBnZXQgb2JzZXJ2ZWRBdHRyaWJ1dGVzKCkge1xuXHRcdHJldHVybiBbJ2J1bmRsZScsICdtdXRlJ107XG5cdH1cblxuXHRjb25zdHJ1Y3RvcigpIHtcblx0XHRzdXBlcigpO1xuXG5cdFx0Y29uc3Qgc2hhZG93ID0gdGhpcy5hdHRhY2hTaGFkb3coeyBtb2RlOiAnb3BlbicgfSk7XG5cblx0XHRjb25zdCB0ZW1wbGF0ZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RlbXBsYXRlJyk7XG5cdFx0dGVtcGxhdGUuaW5uZXJIVE1MID0gdGVtcGxhdGVTdHJpbmc7XG5cdFx0Y29uc3Qgcm9vdCA9IHRlbXBsYXRlLmNvbnRlbnQuY2xvbmVOb2RlKHRydWUpIGFzIEhUTUxFbGVtZW50O1xuXG5cdFx0dGhpcy5fb3ZlcmxheXMgPSB0aHJvd0lmTnVsbChyb290LnF1ZXJ5U2VsZWN0b3IoJyNvdmVybGF5cycpLCAnbWlzc2luZyBvdmVybGF5IGNvbnRhaW5lcicpIGFzIEhUTUxFbGVtZW50O1xuXHRcdHRoaXMuX3NwZWVjaCA9IHRocm93SWZOdWxsKHJvb3QucXVlcnlTZWxlY3RvcignI3NwZWVjaCcpLCAnbWlzc2luZyBzcGVlY2ggY29udGFpbmVyJykgYXMgSFRNTEVsZW1lbnQ7XG5cdFx0dGhyb3dJZk51bGwocm9vdC5xdWVyeVNlbGVjdG9yKCdzbG90JyksICdtaXNzaW5nIHNsb3QnKS5hZGRFdmVudExpc3RlbmVyKCdzbG90Y2hhbmdlJywgKGV2ZW50KSA9PiB7XG5cdFx0XHR0aGlzLl9vblNsb3RDaGFuZ2UoZXZlbnQpO1xuXHRcdH0pO1xuXG5cdFx0Y29uc3Qgc3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpO1xuXHRcdHN0eWxlLnRleHRDb250ZW50ID0gYWdlbnRTdHlsZTtcblxuXHRcdHNoYWRvdy5hcHBlbmRDaGlsZChzdHlsZSk7XG5cdFx0c2hhZG93LmFwcGVuZENoaWxkKHJvb3QpO1xuXHR9XG5cblx0Z2V0IGFjdGlvbnMoKTogc3RyaW5nW10ge1xuXHRcdHJldHVybiBPYmplY3Qua2V5cyh0aGlzLl9jb25maWcuYW5pbWF0aW9ucyk7XG5cdH1cblxuXHRnZXQgY3VycmVudCgpOiBzdHJpbmcgfCB1bmRlZmluZWQge1xuXHRcdHJldHVybiB0aGlzLl9jb250cm9sICYmIHRoaXMuX2NvbnRyb2wuYWN0aW9uO1xuXHR9XG5cblx0YXR0cmlidXRlQ2hhbmdlZENhbGxiYWNrKG5hbWU6IHN0cmluZywgX29sZFZhbHVlOiBzdHJpbmcsIG5ld1ZhbHVlOiBzdHJpbmcpIHtcblx0XHRzd2l0Y2ggKG5hbWUpIHtcblx0XHRcdGNhc2UgJ2J1bmRsZSc6XG5cdFx0XHRcdGNvbnNvbGUud2FybihgbG9hZGluZyAke25ld1ZhbHVlfSBub3QgaW1wbGVtZW50ZWRgKTtcblx0XHRcdFx0YnJlYWs7XG5cdFx0XHRjYXNlICdtdXRlJzpcblx0XHRcdFx0dGhpcy5fbXV0ZSA9IG5ld1ZhbHVlID09PSAndHJ1ZSc7XG5cdFx0XHRcdGJyZWFrO1xuXHRcdH1cblx0fVxuXG5cdGFzeW5jIGxvYWQoY29uZmlnOiBBZ2VudENvbmZpZ3VyYXRpb24pIHtcblx0XHR0aGlzLl9jb25maWcgPSBjb25maWc7XG5cdFx0d2hpbGUgKHRoaXMuX292ZXJsYXlzLmZpcnN0Q2hpbGQpIHtcblx0XHRcdHRoaXMuX292ZXJsYXlzLnJlbW92ZUNoaWxkKHRoaXMuX292ZXJsYXlzLmZpcnN0Q2hpbGQpO1xuXHRcdH1cblx0XHRmb3IgKGxldCBpID0gY29uZmlnLm92ZXJsYXlDb3VudDsgaSA+IDA7IGktLSkge1xuXHRcdFx0dGhpcy5fY3JlYXRlT3ZlcmxheSgpO1xuXHRcdH1cblx0XHR0aGlzLl9vdmVybGF5cy5zdHlsZS5oZWlnaHQgPSBjb25maWcuZnJhbWVTaXplLmhlaWdodCArICdweCc7XG5cdFx0dGhpcy5fb3ZlcmxheXMuc3R5bGUud2lkdGggPSBjb25maWcuZnJhbWVTaXplLndpZHRoICsgJ3B4Jztcblx0XHR0aGlzLl9zb3VuZEJvYXJkID0gYXdhaXQgYXVkaW8ubG9hZChjb25maWcuc291bmRQYWNrKTtcblx0XHR0aGlzLnBsYXkoJ1Nob3cnKTtcblx0fVxuXG5cdHBsYXkoYWN0aW9uOiBzdHJpbmcpIHtcblx0XHRjb25zdCBhbmltYXRpb24gPSB0aGlzLl9jb25maWcuYW5pbWF0aW9uc1thY3Rpb25dO1xuXHRcdGlmICghYW5pbWF0aW9uKSB7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoYEFjdGlvbiAke2FjdGlvbn0gZG9lcyBub3QgZXhpc3RgKTtcblx0XHR9XG5cdFx0dGhpcy5fY29udHJvbCAmJiB0aGlzLl9jb250cm9sLnN0b3BJbW1lZGlhdGVseSgpO1xuXHRcdHRoaXMuZGlzcGF0Y2hFdmVudChcblx0XHRcdG5ldyBDdXN0b21FdmVudCgnYWN0aW9uU3RhcnQnLCB7XG5cdFx0XHRcdGRldGFpbDogeyBhY3Rpb24gfVxuXHRcdFx0fSlcblx0XHQpO1xuXHRcdGxldCB0aW1lID0gMDtcblx0XHR0aGlzLl9jb250cm9sID0ge1xuXHRcdFx0YWN0aW9uLFxuXHRcdFx0Li4uYW5pbWF0b3IoYW5pbWF0aW9uLCAoZnJhbWUpID0+IHtcblx0XHRcdFx0Y29uc3QgeyBpbWFnZXMgPSBbXSB9ID0gZnJhbWU7XG5cdFx0XHRcdHRoaXMuX3NldEZyYW1lcyhpbWFnZXMpO1xuXHRcdFx0XHRmb3IgKGxldCBpID0gaW1hZ2VzLmxlbmd0aDsgaSA8IHRoaXMuX2NvbmZpZy5vdmVybGF5Q291bnQ7IGkrKykge1xuXHRcdFx0XHRcdHRoaXMuX2hpZGVGcmFtZShpKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRpZiAoIXRoaXMuX211dGUgJiYgZnJhbWUuc291bmQpIHtcblx0XHRcdFx0XHR0aGlzLl9zb3VuZEJvYXJkLnBsYXkoU3RyaW5nKGZyYW1lLnNvdW5kKSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0dGhpcy5kaXNwYXRjaEV2ZW50KFxuXHRcdFx0XHRcdG5ldyBDdXN0b21FdmVudCgnZnJhbWUnLCB7XG5cdFx0XHRcdFx0XHRkZXRhaWw6IHsgYWN0aW9uLCBmcmFtZSwgdGltZSB9XG5cdFx0XHRcdFx0fSlcblx0XHRcdFx0KTtcblx0XHRcdFx0dGltZSArPSBmcmFtZS5kdXJhdGlvbjtcblx0XHRcdH0pXG5cdFx0fTtcblx0XHR0aGlzLl9jb250cm9sLmRvbmUuZmluYWxseSgoKSA9PiB7XG5cdFx0XHR0aGlzLmRpc3BhdGNoRXZlbnQoXG5cdFx0XHRcdG5ldyBDdXN0b21FdmVudCgnYWN0aW9uRW5kJywge1xuXHRcdFx0XHRcdGRldGFpbDogeyBhY3Rpb24gfVxuXHRcdFx0XHR9KVxuXHRcdFx0KTtcblx0XHRcdHRoaXMuX2NvbnRyb2wgPSB1bmRlZmluZWQ7XG5cdFx0fSk7XG5cdFx0cmV0dXJuIHRoaXMuX2NvbnRyb2w7XG5cdH1cblxuXHRwbGF5SWRsZSgpIHtcblx0XHRjb25zdCBpZGxlQWN0aW9ucyA9IHRoaXMuYWN0aW9ucy5maWx0ZXIoKGFjdGlvbikgPT4gYWN0aW9uLnN1YnN0cigwLCA0KSA9PT0gJ0lkbGUnKTtcblx0XHR0aGlzLnBsYXkoaWRsZUFjdGlvbnNbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogaWRsZUFjdGlvbnMubGVuZ3RoKV0pO1xuXHR9XG5cblx0c3RvcCgpIHtcblx0XHR0aGlzLl9jb250cm9sICYmIHRoaXMuX2NvbnRyb2wuc3RvcCgpO1xuXHR9XG5cblx0c3RvcEltbWVkaWF0ZWx5KCkge1xuXHRcdHRoaXMuX2NvbnRyb2wgJiYgdGhpcy5fY29udHJvbC5zdG9wSW1tZWRpYXRlbHkoKTtcblx0fVxuXG5cdHByaXZhdGUgX2NyZWF0ZU92ZXJsYXkoKSB7XG5cdFx0Y29uc3Qge1xuXHRcdFx0Y2hhcmFjdGVyTWFwLFxuXHRcdFx0ZnJhbWVTaXplOiB7IHdpZHRoLCBoZWlnaHQgfVxuXHRcdH0gPSB0aGlzLl9jb25maWc7XG5cdFx0Y29uc3Qgb3ZlcmxheSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xuXHRcdG92ZXJsYXkuc3R5bGUud2lkdGggPSB3aWR0aCArICdweCc7XG5cdFx0b3ZlcmxheS5zdHlsZS5oZWlnaHQgPSBoZWlnaHQgKyAncHgnO1xuXHRcdG92ZXJsYXkuc3R5bGUuYmFja2dyb3VuZEltYWdlID0gYHVybCgke2NoYXJhY3Rlck1hcH0pYDtcblx0XHRvdmVybGF5LnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7XG5cdFx0dGhpcy5fb3ZlcmxheXMuYXBwZW5kQ2hpbGQob3ZlcmxheSk7XG5cdH1cblxuXHRwcml2YXRlIF9oaWRlRnJhbWUob3ZlcmxheTogbnVtYmVyID0gMCkge1xuXHRcdGNvbnN0IG5vZGUgPSB0aGlzLl9vdmVybGF5cy5jaGlsZHJlbltvdmVybGF5XSBhcyBIVE1MRWxlbWVudDtcblx0XHRub2RlICYmIChub2RlLnN0eWxlLmRpc3BsYXkgPSAnbm9uZScpO1xuXHR9XG5cblx0cHJpdmF0ZSBfb25TbG90Q2hhbmdlKGV2ZW50OiBFdmVudCkge1xuXHRcdHRoaXMuX3NwZWVjaC5zdHlsZS52aXNpYmlsaXR5ID0gJ3Zpc2libGUnO1xuXHRcdGNvbnNvbGUubG9nKCdzbG90JywgZXZlbnQpO1xuXHR9XG5cblx0cHJpdmF0ZSBfc2V0RnJhbWUoeDogbnVtYmVyLCB5OiBudW1iZXIsIG92ZXJsYXk6IG51bWJlciA9IDApIHtcblx0XHRjb25zdCB7IHdpZHRoLCBoZWlnaHQgfSA9IHRoaXMuX2NvbmZpZy5mcmFtZVNpemU7XG5cdFx0Y29uc3Qgbm9kZSA9IHRoaXMuX292ZXJsYXlzLmNoaWxkcmVuW292ZXJsYXldIGFzIEhUTUxFbGVtZW50O1xuXHRcdGlmICh4ICUgd2lkdGggIT09IDAgfHwgeSAlIGhlaWdodCAhPT0gMCkge1xuXHRcdFx0Y29uc29sZS53YXJuKGBmcmFtZSAke3h9LCR7eX0gaXMgbm90IGEgbXVsdGlwbGUgb2YgZnJhbWUgc2l6ZSAke3dpZHRofSwke2hlaWdodH1gKTtcblx0XHR9XG5cdFx0aWYgKCFub2RlKSB7XG5cdFx0XHR0aHJvdyBuZXcgRXJyb3IoYE1pc3Npbmcgb3ZlcmxheSAke292ZXJsYXl9YCk7XG5cdFx0fVxuXG5cdFx0bm9kZS5zdHlsZS5kaXNwbGF5ID0gJ2Jsb2NrJztcblx0XHRub2RlLnN0eWxlLmJhY2tncm91bmRQb3NpdGlvblggPSAteCArICdweCc7XG5cdFx0bm9kZS5zdHlsZS5iYWNrZ3JvdW5kUG9zaXRpb25ZID0gLXkgKyAncHgnO1xuXHRcdG5vZGUuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xuXHRcdG5vZGUuc3R5bGUudG9wID0gJzAnO1xuXHRcdG5vZGUuc3R5bGUubGVmdCA9ICcwJztcblx0fVxuXG5cdHByaXZhdGUgX3NldEZyYW1lcyhpbWFnZXM6IEZyYW1lSW1hZ2VzKSB7XG5cdFx0aWYgKGltYWdlcykge1xuXHRcdFx0Zm9yIChsZXQgaSA9IDA7IGkgPCBpbWFnZXMubGVuZ3RoOyBpKyspIHtcblx0XHRcdFx0Y29uc3QgW3gsIHldID0gaW1hZ2VzW2ldO1xuXHRcdFx0XHR0aGlzLl9zZXRGcmFtZSh4LCB5LCBpKTtcblx0XHRcdH1cblx0XHR9XG5cdH1cbn1cbiIsInZhciBfX2F3YWl0ZXIgPSAodGhpcyAmJiB0aGlzLl9fYXdhaXRlcikgfHwgZnVuY3Rpb24gKHRoaXNBcmcsIF9hcmd1bWVudHMsIFAsIGdlbmVyYXRvcikge1xyXG4gICAgcmV0dXJuIG5ldyAoUCB8fCAoUCA9IFByb21pc2UpKShmdW5jdGlvbiAocmVzb2x2ZSwgcmVqZWN0KSB7XHJcbiAgICAgICAgZnVuY3Rpb24gZnVsZmlsbGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yLm5leHQodmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHJlamVjdGVkKHZhbHVlKSB7IHRyeSB7IHN0ZXAoZ2VuZXJhdG9yW1widGhyb3dcIl0odmFsdWUpKTsgfSBjYXRjaCAoZSkgeyByZWplY3QoZSk7IH0gfVxyXG4gICAgICAgIGZ1bmN0aW9uIHN0ZXAocmVzdWx0KSB7IHJlc3VsdC5kb25lID8gcmVzb2x2ZShyZXN1bHQudmFsdWUpIDogbmV3IFAoZnVuY3Rpb24gKHJlc29sdmUpIHsgcmVzb2x2ZShyZXN1bHQudmFsdWUpOyB9KS50aGVuKGZ1bGZpbGxlZCwgcmVqZWN0ZWQpOyB9XHJcbiAgICAgICAgc3RlcCgoZ2VuZXJhdG9yID0gZ2VuZXJhdG9yLmFwcGx5KHRoaXNBcmcsIF9hcmd1bWVudHMgfHwgW10pKS5uZXh0KCkpO1xyXG4gICAgfSk7XHJcbn07XHJcbnZhciBfX3Jlc3QgPSAodGhpcyAmJiB0aGlzLl9fcmVzdCkgfHwgZnVuY3Rpb24gKHMsIGUpIHtcclxuICAgIHZhciB0ID0ge307XHJcbiAgICBmb3IgKHZhciBwIGluIHMpIGlmIChPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGwocywgcCkgJiYgZS5pbmRleE9mKHApIDwgMClcclxuICAgICAgICB0W3BdID0gc1twXTtcclxuICAgIGlmIChzICE9IG51bGwgJiYgdHlwZW9mIE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMgPT09IFwiZnVuY3Rpb25cIilcclxuICAgICAgICBmb3IgKHZhciBpID0gMCwgcCA9IE9iamVjdC5nZXRPd25Qcm9wZXJ0eVN5bWJvbHMocyk7IGkgPCBwLmxlbmd0aDsgaSsrKSBpZiAoZS5pbmRleE9mKHBbaV0pIDwgMClcclxuICAgICAgICAgICAgdFtwW2ldXSA9IHNbcFtpXV07XHJcbiAgICByZXR1cm4gdDtcclxufTtcclxuaW1wb3J0IGdsb2JhbCBmcm9tICcuL3V0aWwvZ2xvYmFsJztcclxuY29uc3QgQXVkaW9Db250ZXh0ID0gZ2xvYmFsLkF1ZGlvQ29udGV4dCB8fCBnbG9iYWwud2Via2l0QXVkaW9Db250ZXh0O1xyXG5jb25zdCBtaW1lTWFwID0gbmV3IE1hcChbWydtcDMnLCAnYXVkaW8vbXBlZyddLCBbJ29nZycsICdhdWRpby9vZ2cnXV0pO1xyXG5jb25zdCBhdWRpb1RhZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2F1ZGlvJyk7XHJcbmV4cG9ydCBjbGFzcyBTb3VuZEJvYXJkIHtcclxuICAgIGNvbnN0cnVjdG9yKGNvbnRleHQsIGVmZmVjdHMpIHtcclxuICAgICAgICB0aGlzLmNvbnRleHQgPSBjb250ZXh0O1xyXG4gICAgICAgIHRoaXMuZWZmZWN0cyA9IGVmZmVjdHM7XHJcbiAgICB9XHJcbiAgICBwbGF5KG5hbWUpIHtcclxuICAgICAgICBjb25zdCBidWZmZXIgPSB0aGlzLmVmZmVjdHNbbmFtZV07XHJcbiAgICAgICAgaWYgKGJ1ZmZlcikge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jb250ZXh0LnN0YXRlID09PSAnc3VzcGVuZGVkJykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5jb250ZXh0LnJlc3VtZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnN0IHNvdXJjZSA9IHRoaXMuY29udGV4dC5jcmVhdGVCdWZmZXJTb3VyY2UoKTtcclxuICAgICAgICAgICAgc291cmNlLmJ1ZmZlciA9IGJ1ZmZlcjtcclxuICAgICAgICAgICAgc291cmNlLmNvbm5lY3QodGhpcy5jb250ZXh0LmRlc3RpbmF0aW9uKTtcclxuICAgICAgICAgICAgc291cmNlLnN0YXJ0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLndhcm4oYFNvdW5kYm9hcmQgbWlzc2luZyBlZmZlY3QgZm9yICR7bmFtZX1gKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0IGNsYXNzIENvcmVBdWRpbyB7XHJcbiAgICBjb25zdHJ1Y3Rvcihjb250ZXh0ID0gbmV3IEF1ZGlvQ29udGV4dCgpKSB7XHJcbiAgICAgICAgdGhpcy5jb250ZXh0ID0gY29udGV4dDtcclxuICAgIH1cclxuICAgIGdldCBzdXNwZW5kZWQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY29udGV4dC5zdGF0ZSA9PT0gJ3N1c3BlbmRlZCc7XHJcbiAgICB9XHJcbiAgICByZXN1bWUoKSB7XHJcbiAgICAgICAgdGhpcy5jb250ZXh0LnJlc3VtZSgpO1xyXG4gICAgfVxyXG4gICAgbG9hZChjb25maWcpIHtcclxuICAgICAgICBjb25zdCB7IG1wMywgb2dnIH0gPSBjb25maWcsIHJlc3QgPSBfX3Jlc3QoY29uZmlnLCBbXCJtcDNcIiwgXCJvZ2dcIl0pO1xyXG4gICAgICAgIGlmIChtcDMgJiYgdGhpcy5jYW5QbGF5KCdtcDMnKSkge1xyXG4gICAgICAgICAgICByZXR1cm4gdGhpcy5sb2FkU291bmRQYWNrKG1wMyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKG9nZyAmJiB0aGlzLmNhblBsYXkoJ29nZycpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLmxvYWRTb3VuZFBhY2sob2dnKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChsZXQgZm9ybWF0IGluIHJlc3QpIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuY2FuUGxheShmb3JtYXQpKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gdGhpcy5sb2FkU291bmRQYWNrKHJlc3RbZm9ybWF0XSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KG5ldyBFcnJvcignQ2Fubm90IGxvYWQgYXVkaW8uIE5vIHZhbGlkIHR5cGUuJykpO1xyXG4gICAgfVxyXG4gICAgY2FuUGxheShmb3JtYXQpIHtcclxuICAgICAgICBjb25zdCBtaW1ldHlwZSA9IG1pbWVNYXAuZ2V0KGZvcm1hdCkgfHwgZm9ybWF0O1xyXG4gICAgICAgIHJldHVybiBhdWRpb1RhZy5jYW5QbGF5VHlwZShtaW1ldHlwZSk7XHJcbiAgICB9XHJcbiAgICBsb2FkU291bmRQYWNrKHBhY2spIHtcclxuICAgICAgICBjb25zdCBlZmZlY3RzID0ge307XHJcbiAgICAgICAgY29uc3QgcHJvbWlzZXMgPSBPYmplY3Qua2V5cyhwYWNrKS5tYXAoKGlkKSA9PiB7XHJcbiAgICAgICAgICAgIGNvbnN0IHNyYyA9IHBhY2tbaWRdO1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUpID0+IF9fYXdhaXRlcih0aGlzLCB2b2lkIDAsIHZvaWQgMCwgZnVuY3Rpb24qICgpIHtcclxuICAgICAgICAgICAgICAgIGNvbnN0IGRhdGEgPSB5aWVsZCBmZXRjaChzcmMpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYnVmZmVyID0geWllbGQgZGF0YS5hcnJheUJ1ZmZlcigpO1xyXG4gICAgICAgICAgICAgICAgY29uc3QgYXVkaW8gPSB5aWVsZCB0aGlzLmNvbnRleHQuZGVjb2RlQXVkaW9EYXRhKGJ1ZmZlcik7XHJcbiAgICAgICAgICAgICAgICBlZmZlY3RzW2lkXSA9IGF1ZGlvO1xyXG4gICAgICAgICAgICAgICAgcmVzb2x2ZShhdWRpbyk7XHJcbiAgICAgICAgICAgIH0pKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gUHJvbWlzZS5hbGwocHJvbWlzZXMpLnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gbmV3IFNvdW5kQm9hcmQodGhpcy5jb250ZXh0LCBlZmZlY3RzKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxufVxyXG5leHBvcnQgZGVmYXVsdCBuZXcgQ29yZUF1ZGlvKCk7XHJcbiIsInZhciBnO1xuXG4vLyBUaGlzIHdvcmtzIGluIG5vbi1zdHJpY3QgbW9kZVxuZyA9IChmdW5jdGlvbigpIHtcblx0cmV0dXJuIHRoaXM7XG59KSgpO1xuXG50cnkge1xuXHQvLyBUaGlzIHdvcmtzIGlmIGV2YWwgaXMgYWxsb3dlZCAoc2VlIENTUClcblx0ZyA9IGcgfHwgbmV3IEZ1bmN0aW9uKFwicmV0dXJuIHRoaXNcIikoKTtcbn0gY2F0Y2ggKGUpIHtcblx0Ly8gVGhpcyB3b3JrcyBpZiB0aGUgd2luZG93IHJlZmVyZW5jZSBpcyBhdmFpbGFibGVcblx0aWYgKHR5cGVvZiB3aW5kb3cgPT09IFwib2JqZWN0XCIpIGcgPSB3aW5kb3c7XG59XG5cbi8vIGcgY2FuIHN0aWxsIGJlIHVuZGVmaW5lZCwgYnV0IG5vdGhpbmcgdG8gZG8gYWJvdXQgaXQuLi5cbi8vIFdlIHJldHVybiB1bmRlZmluZWQsIGluc3RlYWQgb2Ygbm90aGluZyBoZXJlLCBzbyBpdCdzXG4vLyBlYXNpZXIgdG8gaGFuZGxlIHRoaXMgY2FzZS4gaWYoIWdsb2JhbCkgeyAuLi59XG5cbm1vZHVsZS5leHBvcnRzID0gZztcbiIsImV4cG9ydCBkZWZhdWx0IFwiLnJvb3Qge1xcblxcdHBvc2l0aW9uOiByZWxhdGl2ZTtcXG59XFxuXFxuI3NwZWVjaCB7XFxuXFx0dmlzaWJpbGl0eTogaGlkZGVuO1xcblxcdHBvc2l0aW9uOiBhYnNvbHV0ZTtcXG5cXHRkaXNwbGF5OiBibG9jaztcXG5cXHRiYWNrZ3JvdW5kLWNvbG9yOiAjRkZDO1xcblxcdHBhZGRpbmc6IDhweDtcXG5cXHR6LWluZGV4OiAxMDAwO1xcblxcdGJvcmRlcjogMXB4IHNvbGlkIGJsYWNrO1xcblxcdGJvcmRlci1yYWRpdXM6IDVweDtcXG59XFxuXFxuLnNwZWVjaC1idWJibGUtbGVmdDphZnRlciB7XFxuXFx0Y29udGVudDogJyc7XFxuXFx0cG9zaXRpb246IGFic29sdXRlO1xcblxcdHJpZ2h0OiAwO1xcblxcdHRvcDogNTAlO1xcblxcdHdpZHRoOiAwO1xcblxcdGhlaWdodDogMDtcXG5cXHRib3JkZXI6IDIwcHggc29saWQgdHJhbnNwYXJlbnQ7XFxuXFx0Ym9yZGVyLWxlZnQtY29sb3I6ICNmZmZmYmI7XFxuXFx0Ym9yZGVyLXJpZ2h0OiAwO1xcblxcdGJvcmRlci1ib3R0b206IDA7XFxuXFx0bWFyZ2luLXRvcDogLTEwcHg7XFxuXFx0bWFyZ2luLXJpZ2h0OiAtMjBweDtcXG59XFxuXFxuLmNvbnRlbnQge1xcblxcdG1heC13aWR0aDogMjAwcHg7XFxuXFx0bWluLXdpZHRoOiAxMjBweDtcXG5cXHRmb250LWZhbWlseTogXFxcIk1pY3Jvc29mdCBTYW5zXFxcIiwgc2Fucy1zZXJpZjtcXG5cXHRmb250LXNpemU6IDEwcHQ7XFxufVxcblxcbiNvdmVybGF5cyB7XFxuXFx0cG9zaXRpb246IHJlbGF0aXZlO1xcbn1cXG5cXG4jb3ZlcmxheXMgPiAqIHtcXG5cXHRwb3NpdGlvbjogYWJzb2x1dGU7XFxuXFx0dG9wOiAwO1xcblxcdGxlZnQ6IDA7XFxufVxcblwiIiwibW9kdWxlLmV4cG9ydHMgPSBcIjxkaXYgY2xhc3M9cm9vdD4gPGRpdiBpZD1zcGVlY2ggY2xhc3M9c3BlZWNoLWJ1YmJsZS1sZWZ0PiA8c2xvdCBuYW1lPVxcXCJcXFwiIGNsYXNzPWNvbnRlbnQ+IDwvc2xvdD4gPC9kaXY+IDxkaXYgaWQ9b3ZlcmxheXM+IDwvZGl2PiA8L2Rpdj4gXCI7IiwiZXhwb3J0IGZ1bmN0aW9uIHNsZWVwKG1pbGxpc2Vjb25kcykge1xyXG4gICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7XHJcbiAgICAgICAgc2V0VGltZW91dChyZXNvbHZlLCBtaWxsaXNlY29uZHMpO1xyXG4gICAgfSk7XHJcbn1cclxuIiwidmFyIF9fYXdhaXRlciA9ICh0aGlzICYmIHRoaXMuX19hd2FpdGVyKSB8fCBmdW5jdGlvbiAodGhpc0FyZywgX2FyZ3VtZW50cywgUCwgZ2VuZXJhdG9yKSB7XHJcbiAgICByZXR1cm4gbmV3IChQIHx8IChQID0gUHJvbWlzZSkpKGZ1bmN0aW9uIChyZXNvbHZlLCByZWplY3QpIHtcclxuICAgICAgICBmdW5jdGlvbiBmdWxmaWxsZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3IubmV4dCh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gcmVqZWN0ZWQodmFsdWUpIHsgdHJ5IHsgc3RlcChnZW5lcmF0b3JbXCJ0aHJvd1wiXSh2YWx1ZSkpOyB9IGNhdGNoIChlKSB7IHJlamVjdChlKTsgfSB9XHJcbiAgICAgICAgZnVuY3Rpb24gc3RlcChyZXN1bHQpIHsgcmVzdWx0LmRvbmUgPyByZXNvbHZlKHJlc3VsdC52YWx1ZSkgOiBuZXcgUChmdW5jdGlvbiAocmVzb2x2ZSkgeyByZXNvbHZlKHJlc3VsdC52YWx1ZSk7IH0pLnRoZW4oZnVsZmlsbGVkLCByZWplY3RlZCk7IH1cclxuICAgICAgICBzdGVwKChnZW5lcmF0b3IgPSBnZW5lcmF0b3IuYXBwbHkodGhpc0FyZywgX2FyZ3VtZW50cyB8fCBbXSkpLm5leHQoKSk7XHJcbiAgICB9KTtcclxufTtcclxuaW1wb3J0IHsgc2xlZXAgfSBmcm9tICcuL3V0aWwvc2xlZXAnO1xyXG5mdW5jdGlvbiBwaWNrUmFuZG9tKGJyYW5jaGVzKSB7XHJcbiAgICBsZXQgcGljayA9IE1hdGgucmFuZG9tKCkgKiAxMDA7XHJcbiAgICBmb3IgKGNvbnN0IGJyYW5jaCBvZiBicmFuY2hlcykge1xyXG4gICAgICAgIHBpY2sgLT0gYnJhbmNoLndlaWdodDtcclxuICAgICAgICBpZiAocGljayA8PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBicmFuY2guZnJhbWVJbmRleDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuZXhwb3J0IGZ1bmN0aW9uKiBzdGVwcGVyKGFuaW1hdGlvbikge1xyXG4gICAgbGV0IG9mZnNldCA9IDA7XHJcbiAgICBsZXQgZnJhbWVzID0gYW5pbWF0aW9uLmZyYW1lcztcclxuICAgIGxldCBleGl0ID0gZmFsc2U7XHJcbiAgICB3aGlsZSAob2Zmc2V0IDwgZnJhbWVzLmxlbmd0aCkge1xyXG4gICAgICAgIGxldCBmcmFtZSA9IGZyYW1lc1tvZmZzZXRdO1xyXG4gICAgICAgIGV4aXQgPSAhISh5aWVsZCBmcmFtZSkgfHwgZXhpdDtcclxuICAgICAgICBpZiAoZXhpdCAmJiBmcmFtZS5leGl0QnJhbmNoKSB7XHJcbiAgICAgICAgICAgIG9mZnNldCA9IGZyYW1lLmV4aXRCcmFuY2g7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGVsc2UgaWYgKGZyYW1lLmJyYW5jaGluZykge1xyXG4gICAgICAgICAgICBvZmZzZXQgPSBwaWNrUmFuZG9tKGZyYW1lLmJyYW5jaGluZy5icmFuY2hlcykgfHwgb2Zmc2V0ICsgMTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgIG9mZnNldCsrO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5leHBvcnQgZnVuY3Rpb24gYW5pbWF0b3IoYW5pbWF0aW9uLCBmcmFtZUNhbGxiYWNrKSB7XHJcbiAgICBjb25zdCBpdGVyYXRvciA9IHN0ZXBwZXIoYW5pbWF0aW9uKTtcclxuICAgIGxldCBleGl0ID0gZmFsc2U7XHJcbiAgICBsZXQgaW1tZWRpYXRlID0gZmFsc2U7XHJcbiAgICBsZXQgY2FsbEltbWVkaWF0ZTtcclxuICAgIGNvbnN0IGRvbmUgPSBQcm9taXNlLnJhY2UoW1xyXG4gICAgICAgICgoKSA9PiBfX2F3YWl0ZXIodGhpcywgdm9pZCAwLCB2b2lkIDAsIGZ1bmN0aW9uKiAoKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IHsgZG9uZSwgdmFsdWU6IGZyYW1lIH0gPSBpdGVyYXRvci5uZXh0KGV4aXQpOyAhaW1tZWRpYXRlICYmICFkb25lOyB7IGRvbmUsIHZhbHVlOiBmcmFtZSB9ID0gaXRlcmF0b3IubmV4dChleGl0KSkge1xyXG4gICAgICAgICAgICAgICAgZnJhbWVDYWxsYmFjayhmcmFtZSk7XHJcbiAgICAgICAgICAgICAgICB5aWVsZCBzbGVlcChmcmFtZS5kdXJhdGlvbik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KSkoKSxcclxuICAgICAgICBuZXcgUHJvbWlzZSgocmVzdWx0KSA9PiB7XHJcbiAgICAgICAgICAgIGNhbGxJbW1lZGlhdGUgPSByZXN1bHQ7XHJcbiAgICAgICAgfSlcclxuICAgIF0pO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBkb25lLFxyXG4gICAgICAgIHN0b3AoKSB7XHJcbiAgICAgICAgICAgIGV4aXQgPSBmYWxzZTtcclxuICAgICAgICAgICAgcmV0dXJuIGRvbmU7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBzdG9wSW1tZWRpYXRlbHkoKSB7XHJcbiAgICAgICAgICAgIGltbWVkaWF0ZSA9IHRydWU7XHJcbiAgICAgICAgICAgIGNhbGxJbW1lZGlhdGUoKTtcclxuICAgICAgICB9XHJcbiAgICB9O1xyXG59XHJcbiJdLCJzb3VyY2VSb290IjoiIn0=